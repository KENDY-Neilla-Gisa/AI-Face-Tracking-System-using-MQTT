<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Face Tracking Dashboard â€” elvin01</title>
    <style>
        /* â”€â”€â”€ Reset & Base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #0d1117 0%, #1a1f2e 100%);
            color: #c9d1d9;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* â”€â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        header {
            width: 100%;
            background: linear-gradient(135deg, #161b22 0%, #1a2233 100%);
            border-bottom: 1px solid #30363d;
            padding: 18px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        header h1 {
            font-size: 1.3rem;
            font-weight: 600;
            color: #58a6ff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .conn-badge {
            padding: 5px 14px;
            border-radius: 20px;
            font-size: 0.82rem;
            font-weight: 600;
            letter-spacing: 0.04em;
            transition: all 0.3s ease;
        }

        .conn-badge.connected {
            background: #1b4332;
            color: #40c057;
            box-shadow: 0 0 8px rgba(64, 192, 87, 0.3);
        }

        .conn-badge.disconnected {
            background: #3d1f1f;
            color: #f87171;
        }

        .conn-badge.connecting {
            background: #3d3520;
            color: #fbbf24;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* â”€â”€â”€ Main Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 1200px;
            padding: 24px;
            margin: 0 auto;
        }

        /* â”€â”€â”€ Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .card {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            padding: 20px 24px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .card h2 {
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: #8b949e;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card .value {
            font-size: 2rem;
            font-weight: 700;
            transition: color 0.3s ease;
        }

        /* â”€â”€â”€ Status-specific colors â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .status-MOVE_LEFT {
            color: #f9826c;
        }

        .status-MOVE_RIGHT {
            color: #79c0ff;
        }

        .status-CENTERED {
            color: #56d364;
        }

        .status-NO_FACE {
            color: #8b949e;
        }

        /* â”€â”€â”€ Enhanced Visualizations â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .servo-vis {
            grid-column: 1 / -1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 28px;
            background: linear-gradient(135deg, #161b22 0%, #1f2937 100%);
        }

        .servo-visual {
            width: 100%;
            max-width: 400px;
            height: 120px;
            background: #0d1117;
            border-radius: 12px;
            position: relative;
            margin: 20px 0;
            overflow: hidden;
        }

        .servo-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: #58a6ff;
            border-radius: 50%;
            transition: left 0.5s ease, background 0.3s ease;
            box-shadow: 0 0 20px rgba(88, 166, 255, 0.5);
        }

        .servo-indicator.locked {
            background: #56d364;
            box-shadow: 0 0 20px rgba(86, 211, 100, 0.5);
        }

        .arrow-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .arrow {
            font-size: 2.4rem;
            transition: all 0.3s ease;
            opacity: 0.2;
            cursor: pointer;
        }

        .arrow:hover {
            opacity: 0.5;
        }

        .arrow.active {
            opacity: 1;
            transform: scale(1.2);
        }

        /* â”€â”€â”€ Analytics Section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .analytics-grid {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .chart-container {
            height: 150px;
            background: #0d1117;
            border-radius: 8px;
            padding: 10px;
            position: relative;
            overflow: hidden;
        }

        .mini-chart {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: flex-end;
            gap: 2px;
        }

        .chart-bar {
            flex: 1;
            background: #58a6ff;
            min-height: 2px;
            transition: height 0.3s ease;
        }

        /* â”€â”€â”€ Enhanced Log â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .log-card {
            grid-column: 1 / -1;
        }

        #log {
            height: 200px;
            overflow-y: auto;
            font-family: 'Cascadia Code', 'Fira Code', monospace;
            font-size: 0.78rem;
            background: #0d1117;
            border: 1px solid #21262d;
            border-radius: 8px;
            padding: 10px;
            color: #8b949e;
        }

        #log .entry {
            margin-bottom: 2px;
            padding: 2px 0;
            border-left: 2px solid transparent;
            transition: all 0.2s ease;
        }

        #log .entry:hover {
            background: rgba(88, 166, 255, 0.1);
            border-left-color: #58a6ff;
        }

        #log .entry .ts {
            color: #484f58;
            margin-right: 8px;
        }

        #log .entry.status-MOVE_LEFT { border-left-color: #f9826c; }
        #log .entry.status-MOVE_RIGHT { border-left-color: #79c0ff; }
        #log .entry.status-CENTERED { border-left-color: #56d364; }
        #log .entry.status-NO_FACE { border-left-color: #8b949e; }

        /* â”€â”€â”€ Performance Metrics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #30363d;
        }

        .metric-item:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-size: 0.85rem;
            color: #8b949e;
        }

        .metric-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: #c9d1d9;
        }

        /* â”€â”€â”€ Controls â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .controls {
            grid-column: 1 / -1;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 8px;
            color: #c9d1d9;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .btn:hover {
            background: #30363d;
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* â”€â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        footer {
            padding: 16px;
            font-size: 0.72rem;
            color: #484f58;
            text-align: center;
            border-top: 1px solid #30363d;
            margin-top: auto;
        }

        /* â”€â”€â”€ Responsive Design â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
                padding: 16px;
            }
            
            header {
                padding: 12px 16px;
            }
            
            header h1 {
                font-size: 1.1rem;
            }
        }
    </style>
</head>

<body>

    <!-- Header -->
    <header>
        <h1>ğŸ¯ Enhanced Face Tracking Dashboard</h1>
        <span id="connBadge" class="conn-badge connecting">Connectingâ€¦</span>
    </header>

    <!-- Main Content -->
    <main class="grid">

        <!-- Movement Status -->
        <div class="card">
            <h2>ğŸ“ Movement Status</h2>
            <div id="statusValue" class="value status-NO_FACE">â€”</div>
        </div>

        <!-- Confidence -->
        <div class="card">
            <h2>ğŸ¯ Confidence</h2>
            <div id="confValue" class="value">â€”</div>
        </div>

        <!-- FPS -->
        <div class="card">
            <h2>âš¡ Performance</h2>
            <div id="fpsValue" class="value">â€”</div>
        </div>

        <!-- Messages -->
        <div class="card">
            <h2>ğŸ“¨ Messages</h2>
            <div id="msgCount" class="value">0</div>
        </div>

        <!-- Servo Visualization -->
        <div class="card servo-vis">
            <h2>ğŸ›ï¸ Servo Control Visualization</h2>
            <div class="servo-visual">
                <div id="servoIndicator" class="servo-indicator"></div>
            </div>
            <div class="arrow-bar">
                <span id="arrowLeft" class="arrow">â—€</span>
                <div id="faceIcon" class="face-icon">ğŸ‘¤</div>
                <span id="arrowRight" class="arrow">â–¶</span>
            </div>
        </div>

        <!-- Analytics Section -->
        <div class="analytics-grid">
            <!-- Status Distribution -->
            <div class="card">
                <h2>ğŸ“Š Status Distribution</h2>
                <div class="chart-container">
                    <div id="statusChart" class="mini-chart"></div>
                </div>
            </div>

            <!-- Performance Metrics -->
            <div class="card">
                <h2>ğŸ“ˆ Performance Metrics</h2>
                <div id="performanceMetrics">
                    <div class="metric-item">
                        <span class="metric-label">Uptime</span>
                        <span class="metric-value" id="uptimeValue">0s</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Avg Confidence</span>
                        <span class="metric-value" id="avgConfValue">0%</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Events/sec</span>
                        <span class="metric-value" id="eventsPerSec">0</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Clients</span>
                        <span class="metric-value" id="clientCount">0</span>
                    </div>
                </div>
            </div>

            <!-- Session Info -->
            <div class="card">
                <h2>ğŸ”’ Session Info</h2>
                <div id="sessionInfo">
                    <div class="metric-item">
                        <span class="metric-label">Lock State</span>
                        <span class="metric-value" id="lockState">SEARCHING</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Session Duration</span>
                        <span class="metric-value" id="sessionDuration">0s</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Total Sessions</span>
                        <span class="metric-value" id="totalSessions">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <button class="btn" onclick="requestHistory()">ğŸ“œ Request History</button>
            <button class="btn" onclick="requestMetrics()">ğŸ“Š Request Metrics</button>
            <button class="btn" onclick="clearLog()">ğŸ—‘ï¸ Clear Log</button>
            <button class="btn" onclick="exportData()">ğŸ’¾ Export Data</button>
        </div>

        <!-- Enhanced Log -->
        <div class="card log-card">
            <h2>ğŸ“ Enhanced Event Log</h2>
            <div id="log"></div>
        </div>

    </main>

    <footer>Team elvin01 â€¢ Enhanced Face Tracking System â€¢ WebSocket ws://127.0.0.1:9002</footer>

    <script>
        // â”€â”€â”€ Configuration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const WS_URL = "ws://127.0.0.1:9002";
        const MAX_LOG = 100;
        const MAX_HISTORY_POINTS = 20;

        // â”€â”€â”€ State Management â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const state = {
            messageCount: 0,
            ws: null,
            statusHistory: [],
            statusCounts: {},
            sessionStartTime: null,
            totalSessions: 0,
            reconnectAttempts: 0
        };

        // â”€â”€â”€ DOM References â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const elements = {
            badge: document.getElementById("connBadge"),
            status: document.getElementById("statusValue"),
            conf: document.getElementById("confValue"),
            fps: document.getElementById("fpsValue"),
            count: document.getElementById("msgCount"),
            log: document.getElementById("log"),
            arrowL: document.getElementById("arrowLeft"),
            arrowR: document.getElementById("arrowRight"),
            face: document.getElementById("faceIcon"),
            servoIndicator: document.getElementById("servoIndicator"),
            statusChart: document.getElementById("statusChart"),
            uptime: document.getElementById("uptimeValue"),
            avgConf: document.getElementById("avgConfValue"),
            eventsPerSec: document.getElementById("eventsPerSec"),
            clientCount: document.getElementById("clientCount"),
            lockState: document.getElementById("lockState"),
            sessionDuration: document.getElementById("sessionDuration"),
            totalSessions: document.getElementById("totalSessions")
        };

        // â”€â”€â”€ WebSocket Logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function connect() {
            elements.badge.className = "conn-badge connecting";
            elements.badge.textContent = "Connectingâ€¦";

            state.ws = new WebSocket(WS_URL);

            state.ws.onopen = () => {
                elements.badge.className = "conn-badge connected";
                elements.badge.textContent = "Connected";
                addLog("ğŸŸ¢ WebSocket connected to " + WS_URL, "success");
                state.reconnectAttempts = 0;
            };

            state.ws.onmessage = (evt) => {
                try {
                    const data = JSON.parse(evt.data);
                    handleMessage(data);
                } catch (e) {
                    addLog("âŒ Bad message: " + evt.data, "error");
                }
            };

            state.ws.onclose = () => {
                elements.badge.className = "conn-badge disconnected";
                elements.badge.textContent = "Disconnected";
                addLog("ğŸ”´ Connection lost â€” reconnecting in 3sâ€¦", "warning");
                
                state.reconnectAttempts++;
                setTimeout(connect, Math.min(3000 * state.reconnectAttempts, 30000));
            };

            state.ws.onerror = () => {
                addLog("ğŸ”¥ WebSocket error", "error");
            };
        }

        // â”€â”€â”€ Message Handling â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function handleMessage(data) {
            state.messageCount++;
            
            switch (data.type) {
                case "tracking_update":
                    handleTrackingUpdate(data);
                    break;
                case "metrics_update":
                    handleMetricsUpdate(data);
                    break;
                case "initial_state":
                    handleInitialState(data);
                    break;
                case "history_response":
                    handleHistoryResponse(data);
                    break;
                case "metrics_response":
                    handleMetricsResponse(data);
                    break;
                default:
                    addLog(`ğŸ“¨ Unknown message type: ${data.type}`, "info");
            }
        }

        function handleTrackingUpdate(data) {
            const event = data.event;
            const analytics = data.analytics || {};
            
            // Update basic displays
            updateStatus(event.status, event.confidence);
            updateConfidence(event.confidence);
            updateFPS(event.fps || 0);
            updateMessageCount();
            
            // Update session info
            updateSessionInfo(event.lock_state || "SEARCHING");
            
            // Update visualizations
            updateServoIndicator(event.status);
            updateArrows(event.status);
            
            // Update analytics
            if (analytics.status_distribution) {
                updateStatusChart(analytics.status_distribution);
            }
            
            // Add to log
            addLog(`${event.status} conf=${event.confidence?.toFixed(2) || 0}`, event.status);
            
            // Track history
            state.statusHistory.push({
                status: event.status,
                confidence: event.confidence,
                timestamp: Date.now()
            });
            
            if (state.statusHistory.length > MAX_HISTORY_POINTS) {
                state.statusHistory.shift();
            }
        }

        function handleMetricsUpdate(data) {
            const metrics = data.metrics || {};
            const performance = data.performance || {};
            
            // Update performance metrics
            if (metrics.uptime) {
                elements.uptime.textContent = formatDuration(metrics.uptime);
            }
            
            if (performance.events_per_second) {
                elements.eventsPerSec.textContent = performance.events_per_second.toFixed(1);
            }
            
            if (performance.client_count !== undefined) {
                elements.clientCount.textContent = performance.client_count;
            }
            
            if (performance.average_confidence !== undefined) {
                elements.avgConf.textContent = (performance.average_confidence * 100).toFixed(1) + "%";
            }
        }

        function handleInitialState(data) {
            addLog("ğŸ¯ Initial state received", "success");
            
            if (data.event) {
                handleTrackingUpdate(data);
            }
            
            if (data.metrics) {
                handleMetricsUpdate(data);
            }
        }

        function handleHistoryResponse(data) {
            addLog(`ğŸ“œ History received: ${data.history?.length || 0} events`, "info");
            
            if (data.analytics) {
                updateStatusChart(data.analytics.status_distribution || {});
            }
        }

        function handleMetricsResponse(data) {
            addLog("ğŸ“Š Detailed metrics received", "info");
            handleMetricsUpdate(data);
        }

        // â”€â”€â”€ UI Update Functions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function updateStatus(status, confidence) {
            elements.status.textContent = status;
            elements.status.className = "value status-" + status;
        }

        function updateConfidence(confidence) {
            elements.conf.textContent = (confidence * 100).toFixed(1) + "%";
        }

        function updateFPS(fps) {
            elements.fps.textContent = fps.toFixed(1) + " FPS";
        }

        function updateMessageCount() {
            elements.count.textContent = state.messageCount;
        }

        function updateSessionInfo(lockState) {
            elements.lockState.textContent = lockState;
            
            if (lockState === "LOCKED" && !state.sessionStartTime) {
                state.sessionStartTime = Date.now();
                state.totalSessions++;
            } else if (lockState !== "LOCKED" && state.sessionStartTime) {
                state.sessionStartTime = null;
            }
            
            elements.totalSessions.textContent = state.totalSessions;
            
            if (state.sessionStartTime) {
                const duration = (Date.now() - state.sessionStartTime) / 1000;
                elements.sessionDuration.textContent = formatDuration(duration);
            } else {
                elements.sessionDuration.textContent = "0s";
            }
        }

        function updateServoIndicator(status) {
            const indicator = elements.servoIndicator;
            
            // Update position based on status
            let leftPercent = 50; // Default center
            
            switch (status) {
                case "MOVE_LEFT":
                    leftPercent = 25;
                    indicator.classList.remove("locked");
                    break;
                case "MOVE_RIGHT":
                    leftPercent = 75;
                    indicator.classList.remove("locked");
                    break;
                case "CENTERED":
                    leftPercent = 50;
                    indicator.classList.add("locked");
                    break;
                case "NO_FACE":
                    leftPercent = 50;
                    indicator.classList.remove("locked");
                    break;
            }
            
            indicator.style.left = leftPercent + "%";
        }

        function updateArrows(status) {
            elements.arrowL.classList.toggle("active", status === "MOVE_LEFT");
            elements.arrowR.classList.toggle("active", status === "MOVE_RIGHT");
            elements.face.classList.toggle("locked", status !== "NO_FACE");
        }

        function updateStatusChart(distribution) {
            const chart = elements.statusChart;
            chart.innerHTML = "";
            
            const total = Object.values(distribution).reduce((sum, count) => sum + count, 0);
            
            Object.entries(distribution).forEach(([status, count]) => {
                const bar = document.createElement("div");
                bar.className = "chart-bar";
                bar.style.height = total > 0 ? (count / total * 100) + "%" : "0%";
                bar.style.background = getStatusColor(status);
                bar.title = `${status}: ${count}`;
                chart.appendChild(bar);
            });
        }

        function getStatusColor(status) {
            const colors = {
                "MOVE_LEFT": "#f9826c",
                "MOVE_RIGHT": "#79c0ff",
                "CENTERED": "#56d364",
                "NO_FACE": "#8b949e"
            };
            return colors[status] || "#58a6ff";
        }

        // â”€â”€â”€ Control Functions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function requestHistory() {
            if (state.ws && state.ws.readyState === WebSocket.OPEN) {
                state.ws.send(JSON.stringify({ type: "request_history" }));
                addLog("ğŸ“œ History requested", "info");
            }
        }

        function requestMetrics() {
            if (state.ws && state.ws.readyState === WebSocket.OPEN) {
                state.ws.send(JSON.stringify({ type: "request_metrics" }));
                addLog("ğŸ“Š Metrics requested", "info");
            }
        }

        function clearLog() {
            elements.log.innerHTML = "";
            addLog("ğŸ—‘ï¸ Log cleared", "info");
        }

        function exportData() {
            const data = {
                timestamp: new Date().toISOString(),
                messageCount: state.messageCount,
                statusHistory: state.statusHistory,
                statusCounts: state.statusCounts,
                totalSessions: state.totalSessions
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `face-tracking-data-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            addLog("ğŸ’¾ Data exported", "success");
        }

        // â”€â”€â”€ Utility Functions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function addLog(text, status = "info") {
            const now = new Date().toLocaleTimeString();
            const entry = document.createElement("div");
            entry.className = `entry status-${status}`;
            entry.innerHTML = `<span class="ts">${now}</span>${text}`;
            elements.log.prepend(entry);
            
            // Trim old entries
            while (elements.log.children.length > MAX_LOG) {
                elements.log.removeChild(elements.log.lastChild);
            }
        }

        function formatDuration(seconds) {
            if (seconds < 60) {
                return `${seconds.toFixed(0)}s`;
            } else if (seconds < 3600) {
                return `${(seconds / 60).toFixed(1)}m`;
            } else {
                return `${(seconds / 3600).toFixed(1)}h`;
            }
        }

        // â”€â”€â”€ Initialize â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        connect();
        
        // Periodic status check
        setInterval(() => {
            if (state.ws && state.ws.readyState === WebSocket.OPEN) {
                state.ws.send(JSON.stringify({ type: "ping" }));
            }
        }, 30000);
    </script>
</body>

</html>
